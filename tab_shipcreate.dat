<?xml version="1.0" encoding="UTF-8"?>

<!-- This file contains the definition of the "talents" tab panel. This tab is where
      the user selects the special talents for the character.

      All public visual elements used with this tab panel start with the prefix "ab"
      to associate them with the tab.
-->

<document signature="Hero Lab Data">
  <!-- shImages portal
        Duplicate of the peImages portal from the Personal tab
   -->
  <portal
    id="shImages"
    style="tblNormal">
    <table_auto
      component="UserImage"
      showtemplate="peImage"
      autothing="mscUserImg"
      allowuserorder="yes"
      showsortset="_CompSeq_">
      <headertitle><![CDATA[
        @text = "Gallery"
        ]]></headertitle>
      <additem><![CDATA[
        @text = "Add Another Image"
        ]]></additem>
      </table_auto>
    </portal>
	
  <!-- shRefit portal -->
  <portal
    id="shRefit"
    style="tblNormal">
    <table_dynamic
      component="Refit"
      showtemplate="SimpleItem"
      choosetemplate="SimpleItem">
      <titlebar><![CDATA[
        @text = "Add a Refit - " & hero.child[resShipRef].field[resSummary].text
        ]]></titlebar>
      <description/>
      <headertitle><![CDATA[
        @text = "Refits - " & hero.child[resShipRef].field[resSummary].text
        ]]></headertitle>
      <additem><![CDATA[
        @text &= "Add New Refit"
        ]]></additem>
      </table_dynamic>
    </portal>
	
  <portal 
    id="hdrFrame" 
    style="lblTitle">
    <label>
      <labeltext>
        @text = "Frame"
        </labeltext>
      </label>
    </portal>
           
  <portal
    id="shFrame"
    style="chsNormal"
    width="150">
    <chooser_table
      component="Frame"
      choosetemplate="SimpleItem"
	  choosesortset="FrameSort">
	  <needtag
        container="CharType"
        thing="ShipType">
        </needtag>
      <chosen><![CDATA[
        if (@ispick = 0) then
          @text = "{text clrwarning}Select Frame"
        else
          @text = "Frame: " & field[name].text
          endif
        ]]></chosen>
      <titlebar><![CDATA[
        @text = "Choose the Frame for your character"
        ]]></titlebar>
      </chooser_table>
    </portal>
	  
  <portal 
    id="hdrProfile" 
    style="lblTitle">
    <label>
      <labeltext>
        @text = "Mission Profile"
        </labeltext>
      </label>
    </portal>
           
  <portal
    id="shProfile"
    style="chsNormal"
    width="150">
    <chooser_table
      component="Profile"
      choosetemplate="SimpleItem">
	  <needtag
        container="CharType"
        thing="ShipType">
        </needtag>
      <chosen><![CDATA[
        if (@ispick = 0) then
          @text = "{text clrwarning}Select Mission Profile"
        else
          @text = "Mission: " & field[name].text
          endif
        ]]></chosen>
      <titlebar><![CDATA[
        @text = "Choose the Mission Profile for your ship"
        ]]></titlebar>
      </chooser_table>
    </portal>

  <!-- shPod portal
  -->
  <portal
    id="shPod"
    style="tblNormal">
    <table_dynamic
      component="MissionPod"
      showtemplate="shPickPod"
      choosetemplate="SimpleItem"
      showfixedlast="no"
      addpick="resShipPod">
	  <needtag
        container="CharType"
        thing="ShipType">
        </needtag>
      <titlebar><![CDATA[
        @text = "Add a Mission Pod - " & hero.child[resShipPod].field[resSummary].text
        ]]></titlebar>
      <description/>
      <headertitle><![CDATA[
        @text = "Mission Pods: " & hero.child[resShipPod].field[resSummary].text
        ]]></headertitle>
      <additem><![CDATA[
        ~set the color based on whether the proper number of slots are allocated
        if (field[resLeft].value = 0) then
          @text = "{text clrgrey}"
        elseif (field[resLeft].value < 0) then
          @text = "{text clrwarning}"
          endif
        @text &= "Add New Pod"
        ]]></additem>
      </table_dynamic>
    </portal>	
	
  <template
    id="fraCustomFrame"
    name="Custom Frame"
    compset="Frame"
    marginhorz="3"
    marginvert="2">

    <portal
      id="lblCustName"
      style="lblNormal">
      <label
        text="Frame Name:">
        </label>
      </portal>

    <portal
      id="CustName"
      style="editNormal">
      <edit 
        field="UserName">
        </edit>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[lblCustName].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~position our tallest portal at the top
      portal[CustName].top = 0

      ~center the other portals vertically
      perform portal[lblCustName].centervert

      ~position the label portal on the far left
      perform portal[lblCustName].alignedge[left,0]

      ~position the name on the left and let it use all available space
      ~portal[CustName].left = portal[CustName].right + 5
	  ~ perform portal[CustName].alignedge[right,0]
	  perform portal[CustName].alignrel[ltor,lblCustName,5]
      portal[CustName].width = width - portal[lblCustName].right

      ]]></position>

    </template>
	
  <template
    id="fraPick"
    name="Frame Pick"
    compset="Frame"
    marginhorz="3"
    marginvert="2">

    <portal
      id="name"
      style="lblNormal"
      showinvalid="yes">
      <label
        field="name">
        </label>
      </portal>

    <portal
      id="info"
      style="actInfo">
      <action
        action="info">
        </action>
      <mouseinfo/>
      </portal>

    <portal
      id="delete"
      style="actDelete"
      tiptext="Click to delete this item">
      <action
        action="delete">
        </action>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[info].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~position our tallest portal at the top
      portal[info].top = 0

      ~center the other portals vertically
      perform portal[name].centervert
      perform portal[delete].centervert

      ~position the delete portal on the far right
      perform portal[delete].alignedge[right,0]

      ~position the info portal to the left of the delete button
      perform portal[info].alignrel[rtol,delete,-8]

      ~position the name on the left and let it use all available space
      portal[name].left = 0
      portal[name].width = minimum(portal[name].width,portal[info].left - 5)

      ~if the Talent is auto-added, change its font to indicate that fact
      if (candelete = 0) then
        perform portal[name].setstyle[lblAuto]
        endif
      ]]></position>

    </template>
	
  <template
    id="shDetails"
    name="Details"
    compset="ShipInfo">

    <portal
      id="lblServiceTitle"
      style="lblTitle">
      <label
        text="Service">
        </label>
      </portal>
  
    <portal
      id="lblLaunch"
      style="lblNormal">
      <label
        text="Entered Service:">
        </label>
      </portal>

    <portal
      id="launch"
      style="editNormal">
      <edit 
        field="shipLaunchYear">
        </edit>
      </portal>
  
    <portal
      id="lblYear"
      style="lblNormal">
      <label
        text="Current Year:">
        </label>
      </portal>

    <portal
      id="year"
      style="editNormal">
      <edit 
        field="shipYear">
        </edit>
      </portal>
	  
    <portal
      id="lblSumm"
      style="lblNormal">
      <label
        text="Commissioned:">
        </label>
      </portal>
	  
    <portal
      id="lblServiceSumm"
      style="lblNormal">
      <label
        field="shipSerSumm">
        </label>
      </portal>
	  
    <portal
      id="lblinfo"
      style="lblTitle">
      <label
        text="Ship Details">
        </label>
      </portal>

    <portal
      id="info"
      style="editNormal">
      <edit
        field="shipDetails"
        ismultiline="yes">
        </edit>
      </portal>
	  
    <portal
      id="lblAffil"
      style="lblNormal">
      <label
        text="Affiliation:">
        </label>
      </portal>

    <portal
      id="affil"
      style="editNormal">
      <edit
        field="shipAffil">
        </edit>
      </portal>
	  
    <position><![CDATA[
	  ~position the lblinfo to span the full width
      portal[lblServiceTitle].width = width
	  portal[lblServiceTitle].left = 0
	  
      ~position the lblinfo to span the full width
      portal[lblinfo].width = width

      ~position the personal details portals beneath the separator bar
      portal[lblAffil].left = 0
      perform portal[lblAffil].alignrel[ttob,lblServiceTitle,5]
	  portal[affil].top = portal[lblAffil].top
	  portal[affil].left = portal[lblAffil].right + 5
	  portal[affil].width = width - portal[affil].left
      portal[lblLaunch].left = 0
      perform portal[lblLaunch].alignrel[ttob,lblAffil,5]
	  portal[launch].top = portal[lblLaunch].top
	  portal[launch].left = portal[lblLaunch].right + 5
      portal[lblYear].left = 0
      perform portal[lblYear].alignrel[ttob,lblLaunch,5]
	  portal[year].top = portal[lblYear].top
	  portal[year].left = portal[lblYear].right + 5
	  portal[lblSumm].left = 0
      perform portal[lblSumm].alignrel[ttob,lblYear,5]
	  portal[lblServiceSumm].top = portal[lblSumm].top
	  portal[lblServiceSumm].left = portal[lblSumm].right + 5
	  
      ~position the personal details portals beneath the separator bar
      portal[lblinfo].left = 0
      perform portal[lblinfo].alignrel[ttob,lblSumm,5]
	  
      portal[info].left = portal[lblinfo].left
      perform portal[info].alignrel[ttob,lblinfo,5]
      portal[info].width = width
      portal[info].height = height - portal[info].top - 10
	  
      ]]></position>

    </template>
  <!-- talPick template
        Displays the name of the pick/thing and an info button with the basic
        description text. This is basically the "SimpleItem" template, with one
        key difference. Auto-added abilities such as those conferred by races are
        sorted and colored differently to distinguish their nature.
  -->
  <template
    id="shPickPod"
    name="Mission Pod Pick"
    compset="MissionPod"
    marginhorz="3"
    marginvert="2">

    <portal
      id="name"
      style="lblNormal"
      showinvalid="yes">
      <label
        field="name">
        </label>
      </portal>
	  
    <portal
      id="info"
      style="actInfo">
      <action
        action="info">
        </action>
      <mouseinfo/>
      </portal>

    <portal
      id="delete"
      style="actDelete"
      tiptext="Click to delete this item">
      <action
        action="delete">
        </action>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[info].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)
	  
      ~position our tallest portal at the top
      portal[info].top = 0

      ~center the other portals vertically
      perform portal[name].centervert
      perform portal[delete].centervert
	  
      ~position the delete portal on the far right
      perform portal[delete].alignedge[right,0]

      ~position the info portal to the left of the delete button
      perform portal[info].alignrel[rtol,delete,-8]

      ~position the name on the left and use availble space, with a gap for menus
      portal[name].left = 0
      portal[name].width = maximum(portal[name].width,portal[info].left - portal[name].left - 50)
	  perform portal[name].sizetofit[10]
		
      ~if the ability is auto-added, change its font to indicate that fact
      if (candelete = 0) then
        perform portal[name].setstyle[lblAuto]
        endif
      ]]></position>

    </template>	
	
  <layout
    id="shipcreate">
    <portalref portal="hdrFrame" />
    <portalref portal="hdrProfile" />
    <portalref portal="shFrame" taborder="10" />
    <portalref portal="shProfile" taborder="20" />
    <portalref portal="shRefit" taborder="30" />
    <portalref portal="shPod" taborder="35" />
    <portalref portal="shImages" taborder="40" />
    <portalref portal="peAdjust" taborder="50" />
    <templateref template="shDetails" thing="mscShip" taborder="35" />

    <!-- This script sizes and positions the layout and its child visual elements. 
	    <portalref portal="hoFrame" taborder="10"/>
 -->
    <position><![CDATA[
      ~freeze our table in advancement mode to disable adding new choices
      ~Note: All freezing must be done *before* any positioning is performed.
      if (state.iscreate = 0) then
        portal[hdrFrame].freeze = 1
        portal[shFrame].freeze = 1
        portal[hdrProfile].freeze = 1
        portal[shProfile].freeze = 1
        portal[shPod].freeze = 1
        endif

      ~depending on our overall height, allow the permanent adjustments table to
      ~grow vertically, with a minimum height allowing for at least two items
      ~Note: We assume a standard height of 460 pixels for the overall tab and grow
      ~relative to that. We base this height on the minimum size of the HL window.
      var limit as number
      limit = 2 + (height - 460) / 40
      limit = maximum(limit,2)
      limit = minimum(limit,6)
      portal[peAdjust].maxrows = limit

      ~position the permanent adjustments table spanning the bottom
      portal[peAdjust].top = height - portal[peAdjust].height
      portal[peAdjust].width = width
	  
	  ~reserve a width of 185 pixels for the user images table
      portal[shImages].width = 200

      ~position the images table in the upper right corner
      portal[shImages].left = width - portal[shImages].width
      portal[shImages].height = portal[peAdjust].top - portal[shImages].top - 10
	  
	  ~allocate the remaining width to the personal details template
      template[shDetails].width = width - portal[shImages].width - 10
	  
      ~position and size the table to span the full layout; it will only use the
      ~vertical space that it actually needs
      portal[hdrFrame].top = 0
      portal[hdrFrame].height = 20
      portal[hdrFrame].width = width - 210
      
      portal[shFrame].top = portal[hdrFrame].bottom + 5
      portal[shFrame].height = 20
      portal[shFrame].width = portal[hdrFrame].width
	  
      ~position the details template between the service template and the adjustment
      portal[hdrProfile].top = portal[shFrame].bottom + 10
      portal[hdrProfile].height = 20
      portal[hdrProfile].width = portal[hdrFrame].width
      
      portal[shProfile].top = portal[hdrProfile].bottom + 5
      portal[shProfile].height = 20
      portal[shProfile].width = portal[hdrFrame].width
	  
	  if (hero.tagis[CharType.typSmallCraft] <> 0) then
	    portal[hdrProfile].visible = 0
	    portal[shProfile].visible = 0
		
        portal[shRefit].top = portal[shFrame].bottom + 10
	  else
	    portal[hdrProfile].visible = 1
	    portal[shProfile].visible = 1
		
        portal[shRefit].top = portal[shProfile].bottom + 10
		endif
	  
      ~ portal[shRefit].top = portal[shProfile].bottom + 10
      ~ portal[shRefit].height = 20
      portal[shRefit].width = portal[hdrFrame].width
	  
	  portal[shPod].visible = #framepodsallowed[]
	  
      portal[shPod].top = portal[shRefit].bottom + 10
      portal[shPod].width = portal[hdrFrame].width
	  
      ~position the details template between the service template and the adjustment
	  
	  if (portal[shPod].visible <> 0) then
	    template[shDetails].top = portal[shPod].bottom + 10
	  else
	    template[shDetails].top = portal[shRefit].bottom + 10
		endif
		
      template[shDetails].height = portal[peAdjust].top - template[shDetails].top
	  
      ]]></position>

    </layout>

  <panel
    id="shipcreate"
    name="Ship Details"
    marginhorz="5"
    marginvert="5"
    order="4">
	<live>ShowTab.Starship</live>
    <layoutref layout="shipcreate"/>
    <position><![CDATA[
      ]]></position>
    </panel>
	
  </document>
